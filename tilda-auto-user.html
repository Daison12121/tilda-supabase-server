<!-- 
–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
–í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –±–ª–æ–∫ T123 (HTML) –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≥–¥–µ –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –æ–±—â–∏–π –∫–æ–¥ —Å–∞–π—Ç–∞ —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Tilda
-->

<script>
(function() {
    'use strict';
    
    const SERVER_URL = 'https://tilda-supabase-server-nodejs-20.up.railway.app';
    
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∑–∞–º–µ–Ω—ã —Ç–µ–∫—Å—Ç–∞
    const USER_ELEMENTS = {
        // –°–µ–ª–µ–∫—Ç–æ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –Ω–∏—Ö –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
        '#rec1235790536 .t-name': 'name',           // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        '#rec1235790536 .t-email': 'email',         // Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
        '#rec1235790536 .t-phone': 'phone',         // –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        '#rec1235790536 .t-company': 'company',     // –ö–æ–º–ø–∞–Ω–∏—è
        '#rec1235790536 .t-position': 'position',   // –î–æ–ª–∂–Ω–æ—Å—Ç—å
        
        // –ú–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã:
        // '.user-name': 'name',
        // '.user-info': 'email',
        // '[data-user="name"]': 'name',
    };
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Tilda
    function getTildaUser() {
        try {
            // –°–ø–æ—Å–æ–± 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const localStorageKeys = [
                'tilda_members_user',
                'tilda_member',
                'tildaUser',
                'tilda_user_data',
                'member_data'
            ];
            
            for (const key of localStorageKeys) {
                const userData = localStorage.getItem(key);
                if (userData) {
                    try {
                        const parsed = JSON.parse(userData);
                        if (parsed && parsed.email) {
                            console.log('üë§ –ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ localStorage:', key, parsed.email);
                            return parsed.email;
                        }
                    } catch (e) {
                        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
                    }
                }
            }
            
            // –°–ø–æ—Å–æ–± 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º cookies
            const cookieKeys = [
                'tilda_member',
                'tilda_user',
                'member_email',
                'user_email'
            ];
            
            for (const key of cookieKeys) {
                const cookieValue = getCookie(key);
                if (cookieValue) {
                    try {
                        const parsed = JSON.parse(decodeURIComponent(cookieValue));
                        if (parsed && parsed.email) {
                            console.log('üë§ –ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ cookies:', key, parsed.email);
                            return parsed.email;
                        }
                    } catch (e) {
                        // –í–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ email —Å—Ç—Ä–æ–∫–∞
                        if (cookieValue.includes('@')) {
                            console.log('üë§ –ù–∞–π–¥–µ–Ω email –≤ cookies:', key, cookieValue);
                            return cookieValue;
                        }
                    }
                }
            }
            
            // –°–ø–æ—Å–æ–± 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Tilda
            if (window.tildaMembers && window.tildaMembers.user && window.tildaMembers.user.email) {
                console.log('üë§ –ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ window.tildaMembers:', window.tildaMembers.user.email);
                return window.tildaMembers.user.email;
            }
            
            if (window.memberData && window.memberData.email) {
                console.log('üë§ –ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ window.memberData:', window.memberData.email);
                return window.memberData.email;
            }
            
            // –°–ø–æ—Å–æ–± 4: –ò—â–µ–º –≤ DOM —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–µ—Å–ª–∏ Tilda –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç email –≥–¥–µ-—Ç–æ)
            const emailElements = document.querySelectorAll('[data-member-email], .member-email, .user-email');
            for (const element of emailElements) {
                const email = element.textContent || element.value || element.dataset.memberEmail;
                if (email && email.includes('@')) {
                    console.log('üë§ –ù–∞–π–¥–µ–Ω email –≤ DOM:', email);
                    return email;
                }
            }
            
            console.log('‚ÑπÔ∏è –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return null;
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Tilda:', error);
            return null;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è cookie
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞
    async function getUserData(email) {
        try {
            console.log('üîç –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', email);
            
            const response = await fetch(`${SERVER_URL}/get-user?email=${encodeURIComponent(email)}`, {
                method: 'GET',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', data);
            
            return data;
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            return null;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    function updateUserElements(userData) {
        if (!userData || !userData.success || !userData.user) {
            console.log('‚ÑπÔ∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
            return;
        }
        
        const user = userData.user;
        console.log('üìù –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:', user);
        
        let updatedCount = 0;
        
        Object.keys(USER_ELEMENTS).forEach(selector => {
            const fieldName = USER_ELEMENTS[selector];
            const elements = document.querySelectorAll(selector);
            
            if (elements.length > 0 && user[fieldName]) {
                elements.forEach(element => {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
                    if (!element.dataset.originalText) {
                        element.dataset.originalText = element.textContent;
                    }
                    
                    element.textContent = user[fieldName];
                    updatedCount++;
                    
                    console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —ç–ª–µ–º–µ–Ω—Ç ${selector}: ${user[fieldName]}`);
                });
            }
        });
        
        if (updatedCount > 0) {
            console.log(`üéâ –û–±–Ω–æ–≤–ª–µ–Ω–æ ${updatedCount} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ`);
        } else {
            console.log('‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ USER_ELEMENTS');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
    function restoreOriginalText() {
        Object.keys(USER_ELEMENTS).forEach(selector => {
            const elements = document.querySelectorAll(selector);
            elements.forEach(element => {
                if (element.dataset.originalText) {
                    element.textContent = element.dataset.originalText;
                }
            });
        });
    }
    
    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    async function initUserData() {
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
        
        // –ò—â–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userEmail = getTildaUser();
        
        if (!userEmail) {
            console.log('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            restoreOriginalText();
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userData = await getUserData(userEmail);
        
        if (userData && userData.success && userData.user) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            updateUserElements(userData);
        } else {
            console.log('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:', userEmail);
            restoreOriginalText();
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Tilda
    function setupAuthListeners() {
        // –°–æ–±—ã—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã —á–ª–µ–Ω—Å—Ç–≤–∞ Tilda
        const authEvents = [
            'tilda:member:login',
            'tilda:member:register', 
            'tilda:member:logout',
            'tilda:auth:success',
            'tilda:auth:logout'
        ];
        
        authEvents.forEach(eventName => {
            window.addEventListener(eventName, function(event) {
                console.log(`üéâ –°–æ–±—ã—Ç–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${eventName}`, event);
                
                if (eventName.includes('logout')) {
                    restoreOriginalText();
                } else {
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Tilda
                    setTimeout(initUserData, 500);
                }
            });
        });
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ localStorage
        window.addEventListener('storage', function(event) {
            if (event.key && event.key.includes('tilda')) {
                console.log('üì¶ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ localStorage:', event.key);
                setTimeout(initUserData, 500);
            }
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
    function setupPeriodicCheck() {
        let lastUserEmail = null;
        
        setInterval(() => {
            const currentUserEmail = getTildaUser();
            
            if (currentUserEmail !== lastUserEmail) {
                console.log('üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', lastUserEmail, '->', currentUserEmail);
                lastUserEmail = currentUserEmail;
                initUserData();
            }
        }, 5000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    window.updateTildaUserData = function() {
        console.log('üîÑ –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
        initUserData();
    };
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    window.debugTildaUser = function() {
        console.log('üîç –û—Ç–ª–∞–¥–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:');
        console.log('localStorage:', localStorage);
        console.log('cookies:', document.cookie);
        console.log('window.tildaMembers:', window.tildaMembers);
        console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–π email:', getTildaUser());
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    function init() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Tilda');
        
        setupAuthListeners();
        setupPeriodicCheck();
        
        // –ò–Ω–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initUserData, 1000);
            });
        } else {
            setTimeout(initUserData, 1000);
        }
        
        console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        console.log('üí° –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: window.debugTildaUser()');
        console.log('üîÑ –î–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: window.updateTildaUserData()');
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º
    init();
    
})();
</script>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ */
[data-original-text] {
    transition: opacity 0.3s ease;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
.user-data-loading {
    opacity: 0.5;
    position: relative;
}

.user-data-loading::after {
    content: "‚è≥";
    position: absolute;
    right: -20px;
    top: 0;
}
</style>