<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #45a049; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>
    
    <div class="test-section">
        <h3>1. –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
        <input type="email" id="testEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email" value="test@aida.kg">
        <button onclick="testAuthSync()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
        <div id="authResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <button onclick="testCurrentUser()">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <div id="currentUserResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email</h3>
        <input type="email" id="getUserEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email" value="test@aida.kg">
        <button onclick="testGetUser()">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <div id="getUserResult" class="result"></div>
    </div>

    <script>
        const SERVER_URL = 'https://tilda-supabase-server-nodejs-20.up.railway.app';
        
        async function testAuthSync() {
            const email = document.getElementById('testEmail').value;
            const resultDiv = document.getElementById('authResult');
            
            if (!email) {
                resultDiv.innerHTML = '<span class="error">–í–≤–µ–¥–∏—Ç–µ email</span>';
                return;
            }
            
            try {
                resultDiv.innerHTML = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...';
                
                const response = await fetch(`${SERVER_URL}/auth-sync`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        action: 'test_login',
                        timestamp: new Date().toISOString(),
                        source: 'test_page',
                        page: window.location.href
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `<span class="success">‚úÖ –£—Å–ø–µ—à–Ω–æ! Email: ${data.email}, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω: ${data.userFound}</span>`;
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${data.error}</span>`;
                }
                
                console.log('Auth sync result:', data);
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}</span>`;
                console.error('Auth sync error:', error);
            }
        }
        
        async function testCurrentUser() {
            const resultDiv = document.getElementById('currentUserResult');
            
            try {
                resultDiv.innerHTML = '–ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...';
                
                const response = await fetch(`${SERVER_URL}/current-user`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.user) {
                    resultDiv.innerHTML = `<span class="success">‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω: ${data.user.name} (${data.user.email})</span>`;
                } else if (data.success && !data.user) {
                    resultDiv.innerHTML = `<span class="error">‚ö†Ô∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π: ${data.message}</span>`;
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${data.error}</span>`;
                }
                
                console.log('Current user result:', data);
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}</span>`;
                console.error('Current user error:', error);
            }
        }
        
        async function testGetUser() {
            const email = document.getElementById('getUserEmail').value;
            const resultDiv = document.getElementById('getUserResult');
            
            if (!email) {
                resultDiv.innerHTML = '<span class="error">–í–≤–µ–¥–∏—Ç–µ email</span>';
                return;
            }
            
            try {
                resultDiv.innerHTML = '–ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...';
                
                const response = await fetch(`${SERVER_URL}/get-user?email=${encodeURIComponent(email)}`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.user) {
                    resultDiv.innerHTML = `<span class="success">‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω: ${data.user.name} (${data.user.email})</span>`;
                } else if (data.success && !data.user) {
                    resultDiv.innerHTML = `<span class="error">‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ</span>`;
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${data.error}</span>`;
                }
                
                console.log('Get user result:', data);
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}</span>`;
                console.error('Get user error:', error);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            console.log('üß™ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            console.log('–°–µ—Ä–≤–µ—Ä:', SERVER_URL);
        };
    </script>
</body>
</html>