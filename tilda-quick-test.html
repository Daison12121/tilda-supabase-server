<!-- 
–ë–´–°–¢–†–´–ô –¢–ï–°–¢ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
–í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –±–ª–æ–∫ T123 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Tilda
-->

<script>
console.log('üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Tilda...');

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function findTildaUser() {
    const results = {
        localStorage: {},
        cookies: {},
        globalVars: {},
        domElements: []
    };
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
    console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage...');
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        
        if (key.toLowerCase().includes('tilda') || 
            key.toLowerCase().includes('member') || 
            key.toLowerCase().includes('user')) {
            results.localStorage[key] = value;
            console.log(`üì¶ localStorage[${key}]:`, value);
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º cookies
    console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º cookies...');
    const cookies = document.cookie.split(';');
    cookies.forEach(cookie => {
        const [name, value] = cookie.trim().split('=');
        if (name && (name.toLowerCase().includes('tilda') || 
                    name.toLowerCase().includes('member') || 
                    name.toLowerCase().includes('user'))) {
            results.cookies[name] = value;
            console.log(`üç™ Cookie[${name}]:`, value);
        }
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ...');
    const globalVars = ['tildaMembers', 'memberData', 'userData', 'currentUser', 'tildaUser'];
    globalVars.forEach(varName => {
        if (window[varName]) {
            results.globalVars[varName] = window[varName];
            console.log(`üåê window.${varName}:`, window[varName]);
        }
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã...');
    const selectors = [
        '[data-member-email]',
        '[data-user-email]', 
        '.member-email',
        '.user-email',
        '.tilda-member',
        '.member-info'
    ];
    
    selectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        if (elements.length > 0) {
            elements.forEach(el => {
                const info = {
                    selector: selector,
                    text: el.textContent,
                    value: el.value,
                    dataset: el.dataset
                };
                results.domElements.push(info);
                console.log(`üéØ DOM —ç–ª–µ–º–µ–Ω—Ç ${selector}:`, info);
            });
        }
    });
    
    return results;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è email –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
function extractEmail(results) {
    console.log('üìß –ò—â–µ–º email –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
    for (const [key, value] of Object.entries(results.localStorage)) {
        try {
            const parsed = JSON.parse(value);
            if (parsed && parsed.email) {
                console.log(`‚úÖ Email –Ω–∞–π–¥–µ–Ω –≤ localStorage[${key}]:`, parsed.email);
                return parsed.email;
            }
        } catch (e) {
            // –í–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞ —Å email
            if (typeof value === 'string' && value.includes('@')) {
                console.log(`‚úÖ Email –Ω–∞–π–¥–µ–Ω –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –≤ localStorage[${key}]:`, value);
                return value;
            }
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º cookies
    for (const [key, value] of Object.entries(results.cookies)) {
        try {
            const decoded = decodeURIComponent(value);
            const parsed = JSON.parse(decoded);
            if (parsed && parsed.email) {
                console.log(`‚úÖ Email –Ω–∞–π–¥–µ–Ω –≤ cookie[${key}]:`, parsed.email);
                return parsed.email;
            }
        } catch (e) {
            // –í–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞ —Å email
            if (typeof value === 'string' && value.includes('@')) {
                console.log(`‚úÖ Email –Ω–∞–π–¥–µ–Ω –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –≤ cookie[${key}]:`, value);
                return value;
            }
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    for (const [key, value] of Object.entries(results.globalVars)) {
        if (value && value.email) {
            console.log(`‚úÖ Email –Ω–∞–π–¥–µ–Ω –≤ window.${key}:`, value.email);
            return value.email;
        }
        if (value && value.user && value.user.email) {
            console.log(`‚úÖ Email –Ω–∞–π–¥–µ–Ω –≤ window.${key}.user:`, value.user.email);
            return value.user.email;
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    for (const element of results.domElements) {
        const email = element.text || element.value || element.dataset.memberEmail || element.dataset.userEmail;
        if (email && email.includes('@')) {
            console.log(`‚úÖ Email –Ω–∞–π–¥–µ–Ω –≤ DOM —ç–ª–µ–º–µ–Ω—Ç–µ:`, email);
            return email;
        }
    }
    
    console.log('‚ùå Email –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return null;
}

// –°–æ–∑–¥–∞–µ–º –ø–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
function createResultPanel(results, email) {
    const panel = document.createElement('div');
    panel.id = 'tilda-user-test-panel';
    panel.style.cssText = `
        position: fixed;
        top: 20px;
        left: 20px;
        width: 400px;
        max-height: 80vh;
        background: white;
        border: 2px solid #333;
        border-radius: 10px;
        padding: 15px;
        z-index: 10000;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        font-family: Arial, sans-serif;
        overflow-y: auto;
        font-size: 12px;
    `;
    
    const hasData = Object.keys(results.localStorage).length > 0 || 
                   Object.keys(results.cookies).length > 0 || 
                   Object.keys(results.globalVars).length > 0 || 
                   results.domElements.length > 0;
    
    panel.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0; color: #333;">üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <button onclick="document.getElementById('tilda-user-test-panel').style.display='none'" 
                    style="background: #f44336; color: white; border: none; border-radius: 3px; padding: 5px 10px; cursor: pointer;">‚úï</button>
        </div>
        
        <div style="margin-bottom: 15px; padding: 10px; border-radius: 5px; background: ${email ? '#4CAF50' : '#f44336'}; color: white;">
            <strong>${email ? '‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω!' : '‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω'}</strong><br>
            ${email ? `Email: ${email}` : '–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞'}
        </div>
        
        ${hasData ? `
            <details style="margin-bottom: 10px;">
                <summary style="cursor: pointer; font-weight: bold;">üì¶ localStorage (${Object.keys(results.localStorage).length})</summary>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 10px;">${JSON.stringify(results.localStorage, null, 2)}</pre>
            </details>
            
            <details style="margin-bottom: 10px;">
                <summary style="cursor: pointer; font-weight: bold;">üç™ Cookies (${Object.keys(results.cookies).length})</summary>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 10px;">${JSON.stringify(results.cookies, null, 2)}</pre>
            </details>
            
            <details style="margin-bottom: 10px;">
                <summary style="cursor: pointer; font-weight: bold;">üåê Global Variables (${Object.keys(results.globalVars).length})</summary>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 10px;">${JSON.stringify(results.globalVars, null, 2)}</pre>
            </details>
            
            <details style="margin-bottom: 10px;">
                <summary style="cursor: pointer; font-weight: bold;">üéØ DOM Elements (${results.domElements.length})</summary>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 10px;">${JSON.stringify(results.domElements, null, 2)}</pre>
            </details>
        ` : `
            <div style="color: #666; text-align: center; padding: 20px;">
                –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.<br>
                –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ —á–ª–µ–Ω—Å—Ç–≤–∞ Tilda.
            </div>
        `}
        
        <button onclick="location.reload()" 
                style="width: 100%; padding: 10px; margin-top: 10px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç
        </button>
    `;
    
    document.body.appendChild(panel);
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
function runTest() {
    console.log('üéØ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞...');
    
    const results = findTildaUser();
    const email = extractEmail(results);
    
    console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:', {
        foundEmail: email,
        dataFound: results
    });
    
    createResultPanel(results, email);
    
    // –ï—Å–ª–∏ email –Ω–∞–π–¥–µ–Ω, –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
    if (email) {
        console.log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É...');
        testServerRequest(email);
    }
}

// –¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
async function testServerRequest(email) {
    try {
        const response = await fetch(`https://tilda-supabase-server-nodejs-20.up.railway.app/get-user?email=${encodeURIComponent(email)}`, {
            method: 'GET',
            mode: 'cors'
        });
        
        const data = await response.json();
        console.log('‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–∞–Ω–µ–ª—å
        const panel = document.getElementById('tilda-user-test-panel');
        if (panel) {
            const serverResult = document.createElement('div');
            serverResult.style.cssText = `
                margin-top: 15px; 
                padding: 10px; 
                border-radius: 5px; 
                background: ${data.success && data.user ? '#4CAF50' : '#ff9800'}; 
                color: white;
            `;
            serverResult.innerHTML = `
                <strong>üåê –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:</strong><br>
                <pre style="font-size: 10px; margin: 5px 0;">${JSON.stringify(data, null, 2)}</pre>
            `;
            panel.appendChild(serverResult);
        }
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É:', error);
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(runTest, 1000);
});

// –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(runTest, 1000);
}

console.log('‚úÖ –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
</script>